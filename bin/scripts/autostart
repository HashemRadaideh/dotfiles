#!/bin/zsh

run() {
  if ! pgrep -u "$USER" -f "$1" > /dev/null; then
    "$@" &
  fi
}

if [ "$XDG_SESSION_TYPE" = "x11" ] && [ -n "${DISPLAY+x}" ]; then
  setxkbmap -layout us,ara -option grp:win_space_toggle
  xmodmap -e "keycode 135 = Super_R"
  xset -b

  run picom  -b --experimental-backends --config "$DOTFILES/config/picom/picom.conf"

  # run polybar
  # run conky -c $HOME/.config/conky/conky.conf

  nitrogen --head="0" --set-zoom-fill --random "$HOME/Pictures/wallpapers"
  # run wal -i "$HOME/Pictures/wallpapers"
  # run feh --bg-fill --randomize "$HOME/Pictures/wallpapers"
  # run komorebi

  # run locker
else
  run waybar

  # run hyprpaper
  # run swaybg
  # run wpapered
  run swww init
  swww img \
    "$(find ~/Pictures/wallpapers/ -type f -exec file {} \; | awk -F':' '/\w+ image/{print $1}' | shuf -n 1)" \
    --transition-type random \
    --transition-angle $((1 + $RANDOM % 360)) \
    --transition-fps 255 &

  run wl-paste --type text --watch cliphist store #Stores only text data
  run wl-paste --type image --watch cliphist store #Stores only image data

  run mako
fi

[ ! "$XDG_CURRENT_DESKTOP" = "awesome" ] && run dunst

run /usr/bin/polkit-dumb-agent

# run wireplumber
run qjwgraph --minimized

run udiskie -s -f pcmanfm

run blueman-applet
run nm-applet --indicator
# run volumeicon

run /usr/bin/emacs --daemon
run discord --start-minimized
run steam -silent
# run /usr/bin/teams %U
# run spotify
# run zoom
