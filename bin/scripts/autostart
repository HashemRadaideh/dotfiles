#!/bin/zsh

run() {
  if ! pgrep -u "$USER" -f "$1" > /dev/null; then
    "$@" &
  fi
}

if [ "$XDG_SESSION_TYPE" = "x11" ] && [ -n "${DISPLAY+x}" ]; then
  setxkbmap -layout us,ara -option grp:win_space_toggle
  xmodmap -e "keycode 135 = Super_R"
  xset -b

  run picom --config "$HOME/.config/picom/picom.conf"

  # run polybar
  # run conky -c $HOME/.config/conky/conky.conf

  nitrogen --head="0" --set-zoom-fill --random "$HOME/Pictures/wallpapers"
  # run wal -i "$HOME/Pictures/wallpapers"
  # run feh --bg-fill --randomize "$HOME/Pictures/wallpapers"
  # run komorebi

  run dunst

  # run locker
else
  run waybar
  run swww init
  # run hyprpaper
  # run swaybg
  # run wpapered

  # swww img \
  #   "$(find ~/Pictures/wallpapers/ -name '*' -exec file {} \; | grep -o -P '^.+: \w+ image' | cut -d':' -f1 | shuf -n 1)" \
  #   --transition-type random \
  #   --transition-angle $((1 + $RANDOM % 360)) \
  #   --transition-fps 255 &

  swww img \
    "$(find ~/Pictures/wallpapers/ -type f -exec file {} \; | awk -F':' '/\w+ image/{print $1}' | shuf -n 1)" \
    --transition-type random \
    --transition-angle $((1 + $RANDOM % 360)) \
    --transition-fps 255 &

  # swww img \
  #   "$(fd . ~/Pictures/wallpapers -tf | shuf -n 1)" \
  #   --transition-type random \
  #   --transition-angle $((1 + $RANDOM % 360)) \
  #   --transition-fps 255

  run wl-paste --type text --watch cliphist store #Stores only text data

  run wl-paste --type image --watch cliphist store #Stores only image data

  run mako
fi

run /usr/bin/polkit-dumb-agent 
# run gnome-keyring-daemon --start

# run wireplumber

run udiskie -s -f pcmanfm

run blueman-applet
run nm-applet --indicator
# run volumeicon

run /usr/bin/emacs --daemon
run discord --start-minimized
# run teams
# run zoom
# run steam
# run spotify
