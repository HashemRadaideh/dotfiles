#!/bin/zsh
input() {
  read name\?"Enter new session name: ";
  echo "$name";
}

session() {
  if [[ -n "$(tmux ls 2>/dev/null | grep -i "windows")" ]]; then
    fzf --layout=reverse --cycle <<< `echo "exit\nnew\n$(tmux ls)"` | awk '{print $1}';
  else
    echo "default";
  fi
}

if [ -z "$TMUX" ]; then
  local session="$(session)"
  case "$session" in
    "exit")    return;;
    "new")     exec tmux -u new -s "$(input)" ;;
    "default") exec tmux -u new -s "$session" ;;
    *)         exec tmux -u attach -t "$session" ;;
  esac
else
  local session="$(session)"
  case "$session" in
    "exit") return;;
    "new")  name="$(input)"; tmux new -d -s "$name"; tmux -u switch -t "$name" ;;
    *)      tmux -u switch -t "$session" ;;
  esac
fi 
