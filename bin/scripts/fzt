#!/usr/bin/env zsh

input() {
  read name\?"Enter new session name: ";
  echo "$name";
}

local session="exit"

if [[ -n "$(tmux -u ls 2>/dev/null | grep -i "windows")" ]]; then
  local list=`echo "exit\nnew\n$(tmux -u ls)"`
  fzf --prompt="Session: " <<< "${list[@]}" | awk '{print $1}' | read -t 5 session
else
  echo "default" | read -t 5 session
fi

if [ -z "$TMUX" ]; then
  case "$session" in
    "exit")    return;;
    "new")     exec tmux -u new -s "$(input)" ;;
    "default") exec tmux -u new -s "$session" ;;
    *)         exec tmux -u attach -t "$session" ;;
  esac
else
  case "$session" in
    "exit") return;;
    "new")  name="$(input)"; tmux -u new -d -s "$name"; tmux -u switch -t "$name" ;;
    *)      tmux -u switch -t "$session" ;;
  esac
fi
