# bind prefix to M-space
unbind-key M-b
set -g prefix M-space

# Reload config file
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Configuration reloaded!"

# set vi motion key mode
setw -g mode-keys vi
set -g status-keys vi

# Choose tree (session/window browser)
bind -n M-S choose-tree -s

# Set easier window split keys
bind "\\" split-window -h
bind - split-window -v

bind -n M-\\ split-window -h -c "#{pane_current_path}"
bind -n M-- split-window -v -c "#{pane_current_path}"

bind -n M-c new-window -c '#{pane_current_path}'

# Synchronize panes (useful for running commands in multiple panes)
bind M-s set-window-option synchronize-panes \; display-message "synchronize-panes is now #{?pane_synchronized,on,off}"

# Shift tab to switch windows
bind -n M-Tab next-window
bind -n M-BTab previous-window

bind -n M-n next-window
bind -n M-p previous-window

# navigation
set -g @tmux-nvim-navigation true
set -g @tmux-nvim-navigation-cycle true
set -g @tmux-nvim-navigation-keybinding-left 'M-h'
set -g @tmux-nvim-navigation-keybinding-down 'M-j'
set -g @tmux-nvim-navigation-keybinding-up 'M-k'
set -g @tmux-nvim-navigation-keybinding-right 'M-l'

# resize
set -g @tmux-nvim-resize true
set -g @tmux-nvim-resize-step-x 1
set -g @tmux-nvim-resize-step-y 1
set -g @tmux-nvim-resize-keybinding-left 'M-H'
set -g @tmux-nvim-resize-keybinding-down 'M-J'
set -g @tmux-nvim-resize-keybinding-up 'M-K'
set -g @tmux-nvim-resize-keybinding-right 'M-L'

# vi motion between panes
# bind h select-pane -L
# bind j select-pane -D
# bind k select-pane -U
# bind l select-pane -R

# # Use Alt-hjkl keys to switch panes
# # bind -n M-h select-pane -L
# # bind -n M-j select-pane -D
# # bind -n M-k select-pane -U
# # bind -n M-l select-pane -R

# is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?)(-wrapped)?(diff)?$'"

# bind-key -n 'M-h' if-shell "$is_vim" 'send-keys M-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
# bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
# bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
# bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }

# bind-key -T copy-mode-vi 'M-h' if -F '#{pane_at_left}' '' 'select-pane -L'
# bind-key -T copy-mode-vi 'M-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
# bind-key -T copy-mode-vi 'M-k' if -F '#{pane_at_top}' '' 'select-pane -U'
# bind-key -T copy-mode-vi 'M-l' if -F '#{pane_at_right}' '' 'select-pane -R'

# # bind -n M-J resize-pane -D 1
# # bind -n M-K resize-pane -U 1
# # bind -n M-H resize-pane -L 1
# # bind -n M-L resize-pane -R 1

# bind -n 'M-H' if-shell "$is_vim" 'send-keys M-H' 'resize-pane -L 1'
# bind -n 'M-J' if-shell "$is_vim" 'send-keys M-J' 'resize-pane -D 1'
# bind -n 'M-K' if-shell "$is_vim" 'send-keys M-K' 'resize-pane -U 1'
# bind -n 'M-L' if-shell "$is_vim" 'send-keys M-L' 'resize-pane -R 1'

# bind-key -T copy-mode-vi M-H resize-pane -L 1
# bind-key -T copy-mode-vi M-J resize-pane -D 1
# bind-key -T copy-mode-vi M-K resize-pane -U 1
# bind-key -T copy-mode-vi M-L resize-pane -R 1

# # Shift tab to switch windows
# bind Tab next-window
# bind BTab previous-window

# # bind -n WheelUpPane if-shell \
# #   -F -t = "#{mouse_any_flag}" \
# #   "send-keys -M" "if -Ft= '#{pane_in_mode}'\
# #   'send-keys -M' 'copy-mode -e; send-keys -M'"

# Copy mode improvements (vi-like bindings)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi q send-keys -X cancel

# Better copy-mode navigation
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line
bind -T copy-mode-vi M send-keys -X middle-line

# Copy-mode search (case-insensitive by default)
bind -T copy-mode-vi / command-prompt -T search -i "send -X search-forward-incremental \"%%%\""
bind -T copy-mode-vi ? command-prompt -T search -i "send -X search-backward-incremental \"%%%\""
bind -T copy-mode-vi n send-keys -X search-again
bind -T copy-mode-vi N send-keys -X search-reverse

# Pane management
# Kill pane with confirmation
bind x confirm-before -p "kill-pane #P? (y/n)" kill-pane
# Kill window with confirmation
bind & confirm-before -p "kill-window #W? (y/n)" kill-window

# Toggle pane zoom (maximize/restore)
bind -n M-z resize-pane -Z

# Break pane into a new window
bind b break-pane
bind -n M-b break-pane

# Join pane from another window
bind -n M-J choose-window "join-pane -h -t '%%'"

# Pane layouts (quick layout switching)
bind Space next-layout
# Even horizontal layout
bind = select-layout even-horizontal
# Even vertical layout
bind | select-layout even-vertical
# Main horizontal layout
bind - select-layout main-horizontal
# Main vertical layout
bind _ select-layout main-vertical
# Tiled layout
bind t select-layout tiled

# Session management
# New session
bind -n M-S-c new-session
# Detach client
bind -n M-d detach-client
# List sessions
bind -n M-S-l list-sessions

# Window management
# Rename window
bind -n M-R command-prompt -I "#W" "rename-window '%%'"
# Swap windows
bind -n M-o swap-window -t -1 \; select-window -t -1
bind -n M-O swap-window -t +1 \; select-window -t +1

# Select last active window
bind -n M-a last-window

# Better mouse support - scroll in copy mode
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t = \; send-keys -M

# Quick pane selection by number (prefix + number)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind -n M-0 select-window -t 10

# Clear screen (useful for clearing scrollback)
bind -n M-k send-keys C-l \; clear-history

# Show pane numbers for a moment
bind -n M-q display-panes -d 0

# Toggle mouse on/off
bind -n M-m set -g mouse \; display-message "Mouse is now #{?mouse,on,off}"

# vim: ft=tmux
